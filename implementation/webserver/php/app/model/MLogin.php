<?php

class MLogin extends MModel {
    public $login;
    public $pwdHash;

    public function __construct() {
        $this->login = "";
        $this->pwdHash = "";
    }

    public function store() {
        if (!parent::store()) return false; // TODO: Change the autogenerated stub
        $sql = "SELECT * from users WHERE login=:login AND pwdhash=:pwdhash";
        $sqls=DB::prepare($sql);
        if (!$sqls->execute(["login" => $this->login,
            "pwdhash" => $this->pwdHash]))
        {
            error_log(get_called_class().": SQL Error.");
            return false;
        }
        $o=$sqls->fetchObject();
        if ($o) {
            header("Location: /");
            $_SESSION["loginId"] = $o->id;
            exit();
        }
        else unset($_SESSION["loginId"]);
        return true;
    }

    public function storeCommit() {
        parent::storeCommit();
    }

    public function delete() {
        if(isset($_SESSION["loginId"])) unset($_SESSION["loginId"]);
        return TRUE;
    }

    public function clickedSubmit() {
        $this->persist();
    }


}